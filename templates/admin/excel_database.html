{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list humanize custom_filters %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/excel_database.css' %}">
<div class="p-6">
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-2">
            <h1 class="text-2xl font-semibold text-gray-900">ìš”ì²­ì„œ List</h1>

            <!-- ì£¼ë¬¸ì„œ ê´€ë¦¬ ì „ìš© ë²„íŠ¼ë“¤ (ì¶”ê°€/ì‚­ì œ) -->
            {% if show_add_delete %}
            <div class="button-group-mobile" style="display: inline-flex; gap: 0; align-items: center;">
                <button onclick="openAddModal()" class="mobile-button-style" style="padding: 0.5rem 1rem; background-color: #dcfce7; color: #166534; border-radius: 9999px; border: 1px solid #86efac; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap; margin: 0;" onmouseover="this.style.backgroundColor='#bbf7d0'" onmouseout="this.style.backgroundColor='#dcfce7'">
                    <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span>ì£¼ë¬¸ì„œ ì¶”ê°€</span>
                </button>
                <button onclick="deleteSelected()" class="mobile-button-style" style="padding: 0.5rem 1rem; background-color: #fee2e2; color: #991b1b; border-radius: 9999px; border: 1px solid #fca5a5; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap; margin: 0;" onmouseover="this.style.backgroundColor='#fecaca'" onmouseout="this.style.backgroundColor='#fee2e2'">
                    <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    <span>ì„ íƒ ì‚­ì œ</span>
                </button>
            </div>
            {% endif %}
        </div>

        <div class="flex space-x-2">
            <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
            <button onclick="window.location.reload()" style="padding: 0.5rem 1rem; background-color: #f3f4f6; color: #374151; border-radius: 9999px; border: 1px solid #d1d5db; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap;" onmouseover="this.style.backgroundColor='#e5e7eb'" onmouseout="this.style.backgroundColor='#f3f4f6'">
                <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span>ìƒˆë¡œê³ ì¹¨</span>
            </button>

            <!-- ì£¼ë¬¸ì„œ ê´€ë¦¬ ì „ìš© ë²„íŠ¼ë“¤ -->
            {% if hide_request_id %}
            <button onclick="sendQuotationGuide()" style="padding: 0.5rem 1rem; background-color: #fef3c7; color: #92400e; border-radius: 9999px; border: 1px solid #fcd34d; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap;" onmouseover="this.style.backgroundColor='#fde68a'" onmouseout="this.style.backgroundColor='#fef3c7'">
                <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m-3-1h6M9 21h6"></path>
                </svg>
                        <span>ê²¬ì  ë° ì…ê¸ˆ<span class="hide-guide-mobile"> ì•ˆë‚´</span></span>
            </button>
            <button onclick="sendPaymentCompletionGuide()" style="padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e40af; border-radius: 9999px; border: 1px solid #93c5fd; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap;" onmouseover="this.style.backgroundColor='#bfdbfe'" onmouseout="this.style.backgroundColor='#dbeafe'">
                <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                        <span>ê²°ì œ ì™„ë£Œ<span class="hide-guide-mobile"> ì•ˆë‚´</span></span>
            </button>
            {% endif %}

            <!-- ìš”ì²­ì„œ ê´€ë¦¬ ì „ìš© ë²„íŠ¼ë“¤ -->
            {% if hide_order_id %}
            <button onclick="sendDraftGuide()" style="padding: 0.5rem 1rem; background-color: #fef3c7; color: #92400e; border-radius: 9999px; border: 1px solid #fcd34d; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap;" onmouseover="this.style.backgroundColor='#fde68a'" onmouseout="this.style.backgroundColor='#fef3c7'">
                <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
                <span>ì†ê¸°ë¡ ì´ˆì•ˆ/ìˆ˜ì •ì•ˆ ì•ˆë‚´</span>
            </button>
            <button onclick="sendFinalDraftGuide()" style="padding: 0.5rem 1rem; background-color: #e9d5ff; color: #6b21a8; border-radius: 9999px; border: 1px solid #d8b4fe; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; white-space: nowrap;" onmouseover="this.style.backgroundColor='#d8b4fe'" onmouseout="this.style.backgroundColor='#e9d5ff'">
                <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                </svg>
                <span>ì†ê¸°ë¡ ìµœì¢…ì•ˆ ì•ˆë‚´</span>
            </button>
            {% endif %}
        </div>
    </div>

    <!-- í•„ë“œ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="fieldEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1002; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="fieldEditModalTitle" style="font-size: 18px; font-weight: 600; color: #111827;">í•„ë“œ í¸ì§‘</h3>
                <button onclick="closeFieldEditModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;">&times;</button>
            </div>

            <div style="margin-bottom: 24px;">
                <label id="fieldEditLabel" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ê°’</label>
                <input id="fieldEditInput" type="text" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;" placeholder="ê°’ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-start;">
                <button id="fieldEditSaveBtn" style="padding: 10px 24px; background-color: #059669; color: white; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#047857'" onmouseout="this.style.backgroundColor='#059669'">
                    ì €ì¥
                </button>
                <button onclick="closeFieldEditModal()" style="padding: 10px 24px; background-color: #e5e7eb; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#d1d5db'" onmouseout="this.style.backgroundColor='#e5e7eb'">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- ê²¬ì  ë°œì†¡ í™•ì¸ ëª¨ë‹¬ -->
    <div id="quotationValidationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #059669;">ğŸ“§ ê²¬ì  ë° ì…ê¸ˆ ì•ˆë‚´ ë°œì†¡ í™•ì¸</h3>
                <button onclick="closeQuotationValidationModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;" onmouseover="this.style.color='#111827'" onmouseout="this.style.color='#6b7280'">&times;</button>
            </div>

            <div id="quotationValidationContent" style="margin-bottom: 24px;">
                <!-- ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div id="quotationValidationButtons" style="display: flex; gap: 12px; justify-content: flex-end;">
                <!-- ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ê²°ì œ ì™„ë£Œ ì•ˆë‚´ ê²€ì¦ ëª¨ë‹¬ -->
    <div id="paymentCompletionValidationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #3b82f6;">ğŸ“§ ê²°ì œ ì™„ë£Œ ì•ˆë‚´ ë°œì†¡ í™•ì¸</h3>
                <button onclick="closePaymentCompletionValidationModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;" onmouseover="this.style.color='#111827'" onmouseout="this.style.color='#6b7280'">&times;</button>
            </div>

            <div id="paymentCompletionValidationContent" style="margin-bottom: 24px;">
                <!-- ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div id="paymentCompletionValidationButtons" style="display: flex; gap: 12px; justify-content: flex-end;">
                <!-- ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì†ê¸°ë¡ ì´ˆì•ˆ/ìˆ˜ì •ì•ˆ ê²€ì¦ ëª¨ë‹¬ -->
    <div id="draftValidationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #059669;">ğŸ“§ ì†ê¸°ë¡ ì´ˆì•ˆ/ìˆ˜ì •ì•ˆ ë°œì†¡ í™•ì¸</h3>
                <button onclick="closeDraftValidationModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;" onmouseover="this.style.color='#111827'" onmouseout="this.style.color='#6b7280'">&times;</button>
            </div>

            <div id="draftValidationContent" style="margin-bottom: 24px;">
                <!-- ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div id="draftValidationButtons" style="display: flex; gap: 12px; justify-content: flex-end;">
                <!-- ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì†ê¸°ë¡ ìµœì¢…ì•ˆ ê²€ì¦ ëª¨ë‹¬ -->
    <div id="finalDraftValidationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #059669;">ğŸ“§ ì†ê¸°ë¡ ìµœì¢…ì•ˆ ë°œì†¡ í™•ì¸</h3>
                <button onclick="closeFinalDraftValidationModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;" onmouseover="this.style.color='#111827'" onmouseout="this.style.color='#6b7280'">&times;</button>
            </div>

            <div id="finalDraftValidationContent" style="margin-bottom: 24px;">
                <!-- ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div id="finalDraftValidationButtons" style="display: flex; gap: 12px; justify-content: flex-end;">
                <!-- ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì£¼ë¬¸ì„œ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="deleteConfirmModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #dc2626;">ğŸ—‘ï¸ ì£¼ë¬¸ì„œ ì‚­ì œ í™•ì¸</h3>
                <button onclick="closeDeleteConfirmModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;">&times;</button>
            </div>

            <div style="background-color: #fee2e2; border-left: 4px solid #dc2626; padding: 16px; margin-bottom: 20px; border-radius: 8px;">
                <p style="color: #991b1b; font-weight: 500; margin: 0;">âš ï¸ ì„ íƒí•œ ì£¼ë¬¸ê³¼ ì—°ê´€ëœ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p>
                <p style="color: #991b1b; font-size: 14px; margin: 8px 0 0 0;">â€¢ S3ì— ì €ì¥ëœ íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.</p>
                <p style="color: #991b1b; font-size: 14px; margin: 4px 0 0 0;">â€¢ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>

            <div id="deleteConfirmContent" style="margin-bottom: 24px;">
                <!-- ì‚­ì œí•  ì£¼ë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeDeleteConfirmModal()" style="padding: 10px 24px; background-color: #e5e7eb; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#d1d5db'" onmouseout="this.style.backgroundColor='#e5e7eb'">
                    ì·¨ì†Œ
                </button>
                <button id="confirmDeleteBtn" onclick="confirmDelete()" style="padding: 10px 24px; background-color: #dc2626; color: white; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#b91c1c'" onmouseout="this.style.backgroundColor='#dc2626'">
                    ì‚­ì œ
                </button>
            </div>
        </div>
    </div>

    <!-- ì£¼ë¬¸ì„œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addOrderModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 800px; width: 90%; height: 80vh; display: flex; flex-direction: column; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #059669;">ğŸ“ ì£¼ë¬¸ì„œ ì¶”ê°€ (DB)</h3>
                <button onclick="closeAddModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;">&times;</button>
            </div>

            <div style="flex: 1; overflow-y: auto; margin-bottom: 20px;">
                <form id="addOrderForm">
                    <!-- ID í•„ë“œ (ìë™ ìƒì„±, ì½ê¸° ì „ìš©) -->
                    <div style="background-color: #f3f4f6; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #6b7280;">Order ID (ìë™ ìƒì„±)</label>
                                <input id="orderIdInput" type="text" readonly style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; background-color: #e5e7eb; color: #6b7280; box-sizing: border-box;" placeholder="ìë™ ìƒì„±ë©ë‹ˆë‹¤">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #6b7280;">Request ID (ìë™ ìƒì„±)</label>
                                <input id="requestIdInput" type="text" readonly style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; background-color: #e5e7eb; color: #6b7280; box-sizing: border-box;" placeholder="ìë™ ìƒì„±ë©ë‹ˆë‹¤">
                            </div>
                        </div>
                    </div>

                    <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì²¨ë¶€ íŒŒì¼ (íŒŒì¼ë‹¹ ìµœëŒ€ 3GB)</label>
                        <div style="position: relative; display: inline-block; width: 100%;">
                            <input type="file" id="fileInput" multiple accept=".txt,.hwp,.doc,.docx,.pdf,.ppt,.pptx,.xls,.xlsx,.mp3,.mp4,.asf,.m4v,.mov,.wmv,.avi,.wav,.zip" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 2;">
                            <button type="button" style="width: 100%; padding: 12px; border: 2px dashed #d1d5db; border-radius: 8px; background-color: #f9fafb; color: #374151; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;" onmouseover="this.style.borderColor='#059669'; this.style.backgroundColor='#f0fdf4'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='#f9fafb'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10,9 9,9 8,9"></polyline>
                                </svg>
                                íŒŒì¼ ì„ íƒ
                            </button>
                        </div>
                        <div id="fileUploadProgress" style="margin-top: 12px; display: none;"></div>
                        <div id="uploadStatusContainer" style="margin-top: 12px; display: none;"></div>                                                <div id="fileTabsContainer" style="margin-bottom: 20px; display: none;">
                            <div id="fileTabs" style="display: flex; gap: 0; padding-bottom: 0; border-bottom: 2px solid #e5e7eb; background-color: #f8f9fa; flex-wrap: nowrap; overflow-x: visible;">
                                <!-- íŒŒì¼ íƒ­ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                            <div id="fileSettingsPanel" style="background-color: #ffffff; border: 2px solid #e5e7eb; border-top: none; padding: 24px; border-radius: 0 0 8px 8px; min-height: 400px;">
                                <!-- íŒŒì¼ë³„ ì„¤ì • íŒ¨ë„ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                        <div id="uploadedFiles" style="margin-top: 12px;"></div>
                    </div>

                    <!-- ë‚˜ë¨¸ì§€ í•„ë“œë“¤ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì£¼ë¬¸ìëª… <span style="color: #dc2626;">*</span></label>
                            <input id="nameInput" type="text" required style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì—°ë½ì²˜ <span style="color: #dc2626;">*</span></label>
                            <input id="phoneInput" type="text" required style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                        </div>
                    </div>

                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì´ë©”ì¼ <span style="color: #dc2626;">*</span></label>
                        <input id="emailInput" type="email" required style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                    </div>

                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì£¼ì†Œ</label>
                        <input id="addressInput" type="text" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ì—´ëŒíŒŒì¼ í˜•ì‹</label>
                            <select id="draftFormatInput" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                <option value="hwp">HWP</option>
                                <option value="docx">DOCX</option>
                                <option value="txt">TXT</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ìµœì¢…ë³¸ ì˜µì…˜</label>
                            <select id="finalOptionInput" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                <option value="file">íŒŒì¼</option>
                                <option value="file_usb">íŒŒì¼ + ë“±ê¸° ìš°í¸ (+5,000ì›)</option>
                                <option value="file_usb_cd">íŒŒì¼ + ë“±ê¸° ìš°í¸ + CD (+6,000ì›)</option>
                                <option value="file_usb_post">íŒŒì¼ + ë“±ê¸° ìš°í¸ + USB (+10,000ì›)</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 16px; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input id="paymentStatusInput" type="checkbox" style="width: 20px; height: 20px; cursor: pointer;">
                            <label for="paymentStatusInput" style="font-size: 14px; font-weight: 500; color: #374151; cursor: pointer;">ê²°ì œ ì—¬ë¶€</label>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ê²°ì œ ê¸ˆì•¡</label>
                            <input id="paymentAmountInput" type="number" min="0" placeholder="ì˜ˆ: 50000" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                        </div>
                    </div>

                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;">ê¸°íƒ€ ì •ë³´</label>
                        <textarea id="notesInput" rows="3" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
                    </div>
                </form>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                <button onclick="confirmCloseAddModal()" style="padding: 10px 24px; background-color: #e5e7eb; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#d1d5db'" onmouseout="this.style.backgroundColor='#e5e7eb'">
                    ì·¨ì†Œ
                </button>
                <button id="saveOrderBtn" onclick="saveOrder()" style="padding: 10px 24px; background-color: #059669; color: white; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#047857'" onmouseout="this.style.backgroundColor='#059669'">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <!-- ì¤‘ë³µ ë°œì†¡ í™•ì¸ ëª¨ë‹¬ -->
    <div id="duplicateSendModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background-color: white; border-radius: 12px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 600; color: #dc2626;">âš ï¸ ì¤‘ë³µ ë°œì†¡ í™•ì¸</h3>
                <button onclick="closeDuplicateModal()" style="color: #6b7280; cursor: pointer; background: none; border: none; font-size: 24px;" onmouseover="this.style.color='#111827'" onmouseout="this.style.color='#6b7280'">&times;</button>
            </div>

            <div id="duplicateHistoryContent" style="margin-bottom: 24px;">
                <!-- ë°œì†¡ ì´ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeDuplicateModal()" style="padding: 10px 20px; background-color: #e5e7eb; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#d1d5db'" onmouseout="this.style.backgroundColor='#e5e7eb'">
                    ì·¨ì†Œ
                </button>
                <button id="confirmSendButton" onclick="confirmDuplicateSend()" style="padding: 10px 20px; background-color: #ef4444; color: white; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#dc2626'" onmouseout="this.style.backgroundColor='#ef4444'">
                    ì¬ë°œì†¡
                </button>
            </div>
        </div>
    </div>

    <!-- ì—‘ì…€ ìŠ¤íƒ€ì¼ í…Œì´ë¸” -->
    <div class="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
        <div class="table-container" style="overflow-x: auto; max-width: 100%; position: relative;">
            <table id="excel-table" class="excel-table" style="width: max-content; border-collapse: collapse;">
                <thead class="bg-gray-50" style="position: sticky; top: 0; z-index: 10;">
                    <tr>
                        <th style="min-width: 50px; width: 50px; position: relative; border-right: 1px solid #e5e7eb; text-align: center;">
                            <div class="th-content">
                                <input type="checkbox" id="select-all-checkbox" onclick="toggleAllCheckboxes()" style="margin: 0;">
                            </div>
                        </th>
                        <th class="sortable-th" style="min-width: 100px; width: 100px; position: relative; border-right: 1px solid #e5e7eb;" data-sort="status">
                            <div class="th-content">
                                ìƒíƒœ
                                <span class="sort-icon">â†•</span>
                            </div>
                        </th>
                        {% if not hide_order_id %}
                        <th class="resizable-th sortable-th" style="min-width: 100px; position: relative;" data-sort="order_id">
                            <div class="th-content">
                                Order ID
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        {% endif %}
                        {% if not hide_request_id %}
                        <th class="resizable-th sortable-th" style="min-width: 100px; position: relative;" data-sort="request_id">
                            <div class="th-content">
                                Request ID
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        {% endif %}
                        <th class="resizable-th" style="min-width: 100px; position: relative;">
                            <div class="th-content">ì²¨ë¶€ íŒŒì¼</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 100px; position: relative;">
                            <div class="th-content">ë…¹ìŒ ìœ„ì¹˜</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 100px; position: relative;">
                            <div class="th-content">ë…¹ì·¨ ì¢…ë¥˜</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 120px; position: relative;">
                            <div class="th-content">ë¶€ë¶„ ë…¹ì·¨ êµ¬ê°„</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 80px; position: relative;">
                            <div class="th-content">ì´ ê¸¸ì´</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 80px; position: relative;">
                            <div class="th-content">í™”ììˆ˜</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 120px; position: relative;">
                            <div class="th-content">í™”ì ì´ë¦„</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 120px; position: relative;">
                            <div class="th-content">ë…¹ìŒ ì¼ì‹œ</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 150px; position: relative;">
                            <div class="th-content">ìƒì„¸ ì •ë³´</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 120px; position: relative;">
                            <div class="th-content">ì—´ëŒíŒŒì¼ í˜•ì‹</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 120px; position: relative;">
                            <div class="th-content">ìµœì¢…ë³¸ ì˜µì…˜</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 100px; position: relative;" data-sort="name">
                            <div class="th-content">
                                ì£¼ë¬¸ì
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 120px; position: relative;" data-sort="phone">
                            <div class="th-content">
                                ì—°ë½ì²˜
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 150px; position: relative;" data-sort="email">
                            <div class="th-content">
                                ì´ë©”ì¼
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 250px; position: relative;" data-sort="address">
                            <div class="th-content">
                                ì£¼ì†Œ
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 100px; position: relative;" data-sort="estimated_price">
                            <div class="th-content">
                                ì˜ˆìƒ ê²¬ì 
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th payment-section-start" style="min-width: 100px; position: relative;" data-sort="payment_status">
                            <div class="th-content">
                                ê²°ì œ ì—¬ë¶€
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th sortable-th" style="min-width: 100px; position: relative;" data-sort="payment_amount">
                            <div class="th-content">
                                ê²°ì œ ê¸ˆì•¡
                                <span class="sort-icon">â†•</span>
                            </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 150px; position: relative;">
                            <div class="th-content">ê²°ì œê¸ˆì•¡ ë³€ë™ ì‚¬ìœ </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 100px; position: relative;">
                            <div class="th-content">í™˜ë¶ˆ ê¸ˆì•¡</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 150px; position: relative;">
                            <div class="th-content">ì·¨ì†Œ ì‚¬ìœ </div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 250px; position: relative;">
                            <div class="th-content">ì†ê¸°ë¡</div>
                            <div class="resize-handle"></div>
                        </th>
                        <th class="resizable-th" style="min-width: 250px; position: relative;">
                            <div class="th-content">ê¸°íƒ€ ì •ë³´</div>
                            <div class="resize-handle"></div>
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    {% regroup cl.result_list by order_id as order_groups %}
                    {% for order_group in order_groups %}
                        {% for result in order_group.list %}
                        <tr class="hover:bg-gray-50 border-b border-gray-200 order-group-{{ forloop.parentloop.counter0|divisibleby:2|yesno:'even,odd' }}"
                            data-order-id="{{ order_group.grouper }}"
                            data-request-id="{{ result.request_id }}"
                            data-is-first-in-group="{% if forloop.first %}true{% else %}false{% endif %}"
                            data-group-size="{{ order_group.list|length }}"
                            data-file-index="{{ forloop.counter0 }}">
                        {% comment %} ì²´í¬ë°•ìŠ¤ ì…€ {% endcomment %}
                        {% if hide_request_id and forloop.first %}
                            {% comment %} Order ID List - ì²´í¬ë°•ìŠ¤ ë³‘í•© {% endcomment %}
                            <td class="excel-cell checkbox-cell merged-cell clickable-checkbox-cell" rowspan="{{ order_group.list|length }}" style="text-align: center; vertical-align: middle; cursor: pointer;" onclick="toggleCheckbox(this)">
                                <input type="checkbox" class="row-checkbox" data-order-id="{{ result.order_id }}" data-request-ids="{% for item in order_group.list %}{{ item.request_id }}{% if not forloop.last %},{% endif %}{% endfor %}" style="margin: 0; pointer-events: none;">
                            </td>
                        {% elif not hide_request_id %}
                            {% comment %} Request ID List - ê°œë³„ ì²´í¬ë°•ìŠ¤ {% endcomment %}
                            <td class="excel-cell checkbox-cell clickable-checkbox-cell" style="text-align: center; vertical-align: middle; cursor: pointer;" onclick="toggleCheckbox(this)">
                                <input type="checkbox" class="row-checkbox" data-request-id="{{ result.request_id }}" style="margin: 0; pointer-events: none;">
                            </td>
                        {% endif %}
                        
                        {% comment %} ìƒíƒœ ì…€ - Order ID Listì™€ Request ID Listì— ë”°ë¼ ë‹¤ë¥¸ ìƒíƒœ í‘œì‹œ {% endcomment %}
                        {% if hide_request_id and forloop.first %}
                            {% comment %} Order ID List - order_status ì‚¬ìš©, ì…€ ë³‘í•© {% endcomment %}
                            <td class="excel-cell status-cell merged-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-current-status="{{ result.order_status }}" data-status-type="order">
                                <div class="status-container">
                                    <span class="status-badge status-{{ result.order_status }}" id="status-badge-{{ result.request_id }}">
                                        {{ result.get_order_status_display|default:"ì ‘ìˆ˜ë¨" }}
                                    </span>
                                    <button class="status-edit-btn" onclick="editStatus('{{ result.request_id }}', '{{ result.order_status }}', 'order')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        {% elif not hide_request_id %}
                            {% comment %} Request ID List - status ì‚¬ìš©, ì…€ ë³‘í•© ì—†ìŒ {% endcomment %}
                            <td class="excel-cell status-cell" data-request-id="{{ result.request_id }}" data-current-status="{{ result.status|default:"received" }}" data-status-type="request">
                                <div class="status-container">
                                    <span class="status-badge status-{{ result.status|default:"received" }}" id="status-badge-{{ result.request_id }}">
                                        {{ result.get_status_display|default:"ì ‘ìˆ˜ë¨" }}
                                    </span>
                                    <button class="status-edit-btn" onclick="editStatus('{{ result.request_id }}', '{% if result.status %}{{ result.status }}{% else %}received{% endif %}', 'request')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        {% endif %}
                        {% comment %} Order ID - ë³‘í•© ëŒ€ìƒ {% endcomment %}
                        {% if hide_request_id and forloop.first %}
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.order_id|default:"-" }}</td>
                        {% elif not hide_request_id and not hide_order_id %}
                        <td class="excel-cell">{{ result.order_id|default:"-" }}</td>
                        {% endif %}
                        {% if not hide_request_id %}
                        <td class="excel-cell">{{ result.request_id|default:result.id }}</td>
                        {% endif %}
                        <td class="excel-cell">
                            {% if result.files.exists %}
                                <div class="file-list">
                                    {% for file in result.files.all %}
                                        <div class="file-item">
                                            <a href="javascript:void(0)" onclick="downloadFile('{{ file.file|escapejs }}', '{{ file.original_name|escapejs }}')" class="file-download-link" title="{{ file.original_name }}">
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="7,10 12,15 17,10"></polyline>
                                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                                </svg>
                                                {{ file.original_name|truncatechars:20 }}
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="excel-cell">{{ result.recording_location|default:"í†µí™”" }}</td>
                        <td class="excel-cell">{{ result.recording_type|default:"ì „ì²´" }}</td>
                        <td class="excel-cell">
                            {% if result.recording_type == "ì „ì²´" %}
                                -
                            {% else %}
                                {% if result.partial_range %}
                                    {{ result.partial_range|linebreaksbr }}
                                {% else %}
                                    -
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="excel-cell">{{ result.total_duration|default:"-" }}</td>
                        <td class="excel-cell">{{ result.speaker_count|default:"1" }}</td>
                        <td class="excel-cell">{{ result.speaker_names|default:"-" }}</td>
                        <td class="excel-cell">{{ result.recording_date|date:"Y-m-d H:i"|default:"-" }}</td>
                        <td class="excel-cell">{{ result.additional_info|default:"-" }}</td>
                        {% comment %} ì£¼ë¬¸ ê´€ë ¨ ì •ë³´ - ë³‘í•© ëŒ€ìƒ {% endcomment %}
                        {% if hide_request_id and forloop.first %}
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.get_draft_format_display|default:"HWP" }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.get_final_option_display|default:"ê¸°ë³¸" }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.name }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.phone|format_phone }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.email }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{{ result.address|default:"-" }}</td>
                        <td class="excel-cell merged-cell" rowspan="{{ order_group.list|length }}">{% if result.estimated_price %}{{ result.estimated_price|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</td>
                        <td class="excel-cell merged-cell payment-section-start payment-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-current-payment="{{ result.payment_status }}">
                            <div class="payment-container">
                                <span class="payment-badge payment-{{ result.payment_status }}">
                                    {{ result.payment_status|yesno:"ê²°ì œ ì™„ë£Œ,ë¯¸ê²°ì œ,ë¯¸ê²°ì œ" }}
                                </span>
                                <button class="payment-edit-btn" onclick="editPayment('{{ result.request_id }}', '{{ result.payment_status }}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell merged-cell editable-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-field="payment_amount" data-type="number">
                            <div class="editable-container">
                                <span class="editable-value">{% if result.payment_amount %}{{ result.payment_amount|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'payment_amount', 'number')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell merged-cell editable-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-field="price_change_reason" data-type="text">
                            <div class="editable-container">
                                <span class="editable-value">{{ result.price_change_reason|default:"-" }}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'price_change_reason', 'text')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell merged-cell editable-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-field="refund_amount" data-type="number">
                            <div class="editable-container">
                                <span class="editable-value">{% if result.refund_amount %}{{ result.refund_amount|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'refund_amount', 'number')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell merged-cell editable-cell" rowspan="{{ order_group.list|length }}" data-request-id="{{ result.request_id }}" data-field="cancel_reason" data-type="text">
                            <div class="editable-container">
                                <span class="editable-value">{{ result.cancel_reason|default:"-" }}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'cancel_reason', 'text')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        {% elif not hide_request_id %}
                        <td class="excel-cell">{{ result.get_draft_format_display|default:"HWP" }}</td>
                        <td class="excel-cell">{{ result.get_final_option_display|default:"ê¸°ë³¸" }}</td>
                        <td class="excel-cell">{{ result.name }}</td>
                        <td class="excel-cell">{{ result.phone|format_phone }}</td>
                        <td class="excel-cell">{{ result.email }}</td>
                        <td class="excel-cell">{{ result.address|default:"-" }}</td>
                        <td class="excel-cell">{% if result.estimated_price %}{{ result.estimated_price|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</td>
                        <td class="excel-cell payment-section-start payment-cell" data-request-id="{{ result.request_id }}" data-current-payment="{{ result.payment_status }}">
                            <div class="payment-container">
                                <span class="payment-badge payment-{{ result.payment_status }}">
                                    {{ result.payment_status|yesno:"ê²°ì œ ì™„ë£Œ,ë¯¸ê²°ì œ,ë¯¸ê²°ì œ" }}
                                </span>
                                <button class="payment-edit-btn" onclick="editPayment('{{ result.request_id }}', '{{ result.payment_status }}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="payment_amount" data-type="number">
                            <div class="editable-container">
                                <span class="editable-value">{% if result.payment_amount %}{{ result.payment_amount|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'payment_amount', 'number')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="price_change_reason" data-type="text">
                            <div class="editable-container">
                                <span class="editable-value">{{ result.price_change_reason|default:"-" }}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'price_change_reason', 'text')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="refund_amount" data-type="number">
                            <div class="editable-container">
                                <span class="editable-value">{% if result.refund_amount %}{{ result.refund_amount|floatformat:"0"|intcomma }}ì›{% else %}-{% endif %}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'refund_amount', 'number')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="cancel_reason" data-type="text">
                            <div class="editable-container">
                                <span class="editable-value">{{ result.cancel_reason|default:"-" }}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'cancel_reason', 'text')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        {% endif %}
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="transcript_file" data-type="file">
                            <div class="editable-container">
                                <span class="editable-value" data-original-transcript="{{ result.transcript_file.original_name|default:'-'|escapejs }}">
                                    {% if result.transcript_file %}
                                        {{ result.transcript_file.original_name|truncatechars:30|default:"-" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </span>
                                <button class="edit-btn" onclick="openFileDialog('{{ result.request_id }}', 'transcript_file')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="excel-cell editable-cell" data-request-id="{{ result.request_id }}" data-field="notes" data-type="text">
                            <div class="editable-container">
                                <span class="editable-value">{{ result.notes|default:"-" }}</span>
                                <button class="edit-btn" onclick="editField('{{ result.request_id }}', 'notes', 'text')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="25" class="text-center py-8 text-gray-500">
                            ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="{% static 'admin/js/excel_database/excel_database.js' %}"></script>
</div>
{% endblock %}